syntax = "proto3";
package s2s;
import "google/protobuf/any.proto";

message mysql //mysql操作
{
    message create
    {
        string db = 1; //库
        string tab = 2;  //表
        string proto = 3; //对应的pb协议
        repeated string keys = 4; //主键
        repeated string indexs = 5; //索引
    }
    message add
    {
        int64 flag = 1;
        string table = 2;
        google.protobuf.Any data = 3;
    }
    message save
    {
        int64 flag = 1;
        string table = 2;
        google.protobuf.Any data = 3;
    }
    message query
    {
        int64 flag = 1;
        string table = 2;
        string where_json = 3;
    }
    message remove
    {
        int64 flag = 1;
        string table = 2;
        string where_json = 3;
    }
    message update
    {
        int64 flag = 1;
        string table = 2;
        string update_json = 3;
        string where_json = 4;
    }
    message response
    {
        string error = 1;
        repeated string jsons = 2;
    }
}

message mongo
{
    message insert
    {
        string tab = 1;
        string json = 2;
    }
    message query
    {
        message request
        {
            string tab = 1;
            string json = 2;
            int32 limit = 3;
        }
        message response
        {
            repeated string jsons = 1;
        }
    }
    message remove
    {
        string tab = 1;
        string json = 2;
        int32 limit = 3;
    }
    message update
    {
        string tab = 1;
        string select = 2;
        string update = 3;
        string tag = 4;
    }
    message add_counter
    {
        message request
        {
            string key = 1;
        }
        message response
        {
            int64 value = 1;
        }
    }
}

//网关

message allot
{
    message response
    {
        string token = 1;
        string address = 2; //网关地址
    }

    message save
    {
        string service = 1;
        string address = 2;
    }
}

message broadcast
{
    message request
    {
        string func = 1;
        google.protobuf.Any data = 2;
    }
    message response
    {
        int32 count = 1;
    }
}

message client
{
    message call
    {
        string func = 1;
        google.protobuf.Any data = 2;
    }
}
